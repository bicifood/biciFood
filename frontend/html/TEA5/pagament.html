<!DOCTYPE html>
<html lang="ca">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BiciFood</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-providers@latest/leaflet-providers.js"></script>
  <link rel="stylesheet" href="style.css">
  <script src="/frontend/js/i18n.js"></script>
</head>

<body class="bg-pagament">

  <!-- NAVBAR -->
  <header class="header bg-brown shadow-sm sticky-top">
    <div id="navbar"></div>

        <script>
            fetch("components/navbar.html")
                .then(response => response.text())
                .then(data => {
                    document.getElementById("navbar").innerHTML = data;

                    // Aplicar traduccions al carregar la navbar
                    if (window.i18n) i18n.applyTranslations();

                    // Reactivar el selector d'idioma
                    const langSelector = document.getElementById('lang-selector');
                    if (langSelector) {
                        langSelector.value = i18n.getLanguage();
                        langSelector.addEventListener('change', (e) => {
                            i18n.setLanguage(e.target.value);
                        });
                    }
                });
        </script>
  </header>

  <!-- CONTINGUT CENTRAL -->
  <main class="container my-5">


    <div class="row justify-content-center">
  <div class="col-12 col-lg-10 col-xl-8"> <!-- mÃ©s ample -->

    <!-- CARD -->
    <div class="card p-4" style="background-color: rgba(255, 255, 255, 0.95); border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

      <h2 class="text-center mb-4 fw-bold">Comanda confirmada!</h2>
      <h4 class="text-center mb-4">
        <i class="bi bi-stopwatch"></i> Arriba en: 34 min.
      </h4>

      <!-- Map dins card -->
      <div id="map" style="height: 500px; border-radius: 10px; overflow: hidden;"></div>

    </div>

  </div>
</div>


  </main>

  <!-- BOTÃ“ TORNAR A DALT -->
<button id="scrollTop" class="scroll-top" aria-label="Tornar a dalt" title="Tornar a dalt">â†‘</button>

  <!-- FOOTER -->
  <footer class="footer bg-lightbrown text-dark py-3 mt-auto">
    <div class="container d-flex justify-content-between align-items-center flex-wrap">
      <strong>BiciFood</strong>
      <span>&copy; 2025 BiciFood. Tots els drets reservats.</span>
      <a href="politica.html" class="text-decoration-none text-dark">PolÃ­tica de privadesa</a>
    </div>
  </footer>

  <!-- Bootstrap & Icons -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- SCRIPT DEL MAPA -->
  <script>
    var map = L.map('map').setView([41.3748105, 2.1682657], 20);

    var iconaBicicleta = L.divIcon({
      html: '<i class="bi bi-bicycle" style="font-size: 40px; color: #e47f00;"></i>',
      className: 'bicicleta-icon',
      iconSize: [28, 28],
      iconAnchor: [14, 14],
      popupAnchor: [0, -14]
    });

    const simulacioSeguiment = [
      [41.3748, 2.1682],
      [41.3880, 2.1800],
      [41.3950, 2.1780],
      [41.4000, 2.1760],
      [41.4035, 2.1745]
    ];

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const restaurantMarker = L.marker(simulacioSeguiment[0]).addTo(map)
      .bindPopup('Sortint del restaurant ðŸ½ï¸')
      .openPopup();

    const deliveryMarker = L.marker(simulacioSeguiment[0], { icon: iconaBicicleta })
      .addTo(map);

    let index = 0;
    const cadaXmicrosegons = 5000;

    const simInterval = setInterval(() => {
      index++;
      if (index >= simulacioSeguiment.length) {
        clearInterval(simInterval);
        deliveryMarker.setLatLng(simulacioSeguiment.at(-1));
        deliveryMarker.bindPopup('Entregat! âœ…').openPopup();
        return;
      }

      const pos = simulacioSeguiment[index];
      deliveryMarker.setLatLng(pos);
      map.panTo(pos, { animate: true, duration: 1 });
    }, cadaXmicrosegons);
  </script>

</body>

</html>
